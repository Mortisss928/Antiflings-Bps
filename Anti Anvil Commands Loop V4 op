local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

local targetName = nil

local function getPlayer(str)
    str = str:lower()
    for _, v in pairs(Players:GetPlayers()) do
        if v.Name:lower():sub(1, #str) == str or v.DisplayName:lower():sub(1, #str) == str then
            return v.Name
        end
    end
end

LocalPlayer.Chatted:Connect(function(msg)
    local args = string.split(msg, " ")
    local cmd = args[1]:lower()
    if cmd == ".anb" and args[2] then
        targetName = getPlayer(args[2])
    elseif cmd == ".clr" then
        targetName = nil
    end
end)

RunService.Heartbeat:Connect(function()
    if targetName then
        local p = Players:FindFirstChild(targetName)
        if p and p.Character and p.Character:FindFirstChild("Anvil") then
            pcall(function()
                -- Envoi de l'Anvil au CFrame extrême
                p.Character.Anvil.send:FireServer(CFrame.new(9e38, 9e38, 9e38))
                
                -- ArmAngleChange au moment du tir
                if p.Character:FindFirstChild("ArmAngleChange") then
                    p.Character.ArmAngleChange:FireServer(CFrame.new(9e37, -9e37, 9e37))
                end

                -- Loop sur tous les MeshPart du personnage ciblé
                for _, part in ipairs(p.Character:GetDescendants()) do
                    if part:IsA("MeshPart") then
                        if LocalPlayer.Character then
                            LocalPlayer.Character.Picking:FireServer(part, Vector3.new(9e37, -9e37, 9e37))
                            task.wait(0.005)
                            LocalPlayer.Character.PuttingDown:FireServer()
                        end
                    end
                end
            end)
        end
    end
end)
